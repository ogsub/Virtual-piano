package pack;

import java.awt.*;
import java.awt.Dialog.ModalityType;
import java.awt.event.*;
import javax.swing.BoxLayout;
import javax.swing.JOptionPane;


public class MainFrame extends Frame {
	private Panel pianoPanel;
	private Panel graphicsPanel;
	private Panel recordPanel;
	private Panel playPanel;
	private Composition comp;
	private Piano piano;
	private Dialog dialog;
	private TextField txtComp = new TextField("C:\\Users\\Ognjen\\Desktop\\Q.txt");
	private TextField txtMap = new TextField("C:\\Users\\Ognjen\\Desktop\\POOPzad\\map.csv");
	private Button dialogButton = new Button("Apply");
	private Button playComposition = new Button("Play composition");
	private Button recordButton = new Button("Record");
	private Label recordLabel = new Label("Save path");
	private TextField recordPath = new TextField("C:\\Users\\Ognjen\\Desktop\\midifile.mid");
	
	private GraphicsComposition gc;
	
	public MainFrame() {
		super("Piano 3000");
		setBounds(0,0, 1750, 1000);
		addComponents();
		
		addWindowListener(new WindowAdapter() {
			@Override
			public void windowClosing(WindowEvent e) {
				int confirm = JOptionPane.showOptionDialog(new Frame(),
                        "Are You Sure to Close this Application?",
                        "Exit Confirmation", JOptionPane.YES_NO_OPTION,
                        JOptionPane.QUESTION_MESSAGE, null, null, null);
                if(confirm == 0) {
					dispose();
					System.exit(0);
                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             			}
		});
	}
	
	private void addComponents() {
		MenuBar mb = new MenuBar();
		Menu m = new Menu("Menu");
		m.add("Add composition text");
		m.addSeparator();
		m.add("Exit");
		mb.add(m);
		
		dialog = new Dialog(this, "Enter required data", false);
		dialog.setModalityType(ModalityType.APPLICATION_MODAL);
		//dialog.setAlwaysOnTop(true);
		dialog.setLayout(new BoxLayout(dialog, BoxLayout.Y_AXIS));
		dialog.setSize(400, 300);
		dialog.add(new Label("Composition txt path"));
		dialog.add(txtComp);
		dialog.add(new Label("Map path"));
		dialog.add(txtMap);
		dialogButton.setSize(10, 20);
		playComposition.addActionListener((e)->{
			piano.new AutoPlayThread(comp.getKeysList(), comp.getDurationList(), gc);
		});
		
		recordButton.addActionListener((e)->{
			if(recordButton.getLabel() == "Record") {
				recordButton.setLabel("Save");
				piano.startRecording(true, recordPath.getText().replace("mid", "txt"));
			}
			else {
				recordButton.setLabel("Record");
				piano.setFirstNoteRecording(true);
				piano.saveRecording(recordPath.getText());
			}
		});
		/////////////////C:\Users\Ognjen\Desktop\Q.txt
		/////////////////C:\Users\Ognjen\Desktop\POOPzad\map.csv
		dialogButton.addActionListener((e)->{
			dialog.setVisible(false);
			System.out.println(txtComp.getText() + " " + txtMap.getText());
			if(txtMap.getText() != "") {
				if(piano == null) {
					piano = new Piano(new NoteMap(txtMap.getText()));
					pianoPanel.add(piano);
				}
				recordPanel.add(recordLabel);
				recordPanel.add(recordPath);
				recordPanel.add(recordButton);
				recordPanel.validate();
				if(txtComp.getText() != "") {
					//if(comp == null)
						comp = new Composition(new CompositionText(txtComp.getText()), new NoteMap(txtMap.getText()));
					if(gc != null) {
						graphicsPanel.remove(gc);
					}
					gc = new GraphicsComposition(comp.getKeysList(), comp.getDescriptionsList(), comp.getDurationList());
					gc.fillImgFields();
					piano.addShiftThread(comp.getKeysList(), gc);
					graphicsPanel.add(gc);
					recordPanel.add(new Panel(new GridBagLayout()).add(playComposition), BorderLayout.LINE_END);
					recordPanel.validate();
//					playPanel.add(new Panel(new GridBagLayout()).add(playComposition), BorderLayout.LINE_END);
//					playPanel.validate();
				}
			}
			
			comp.printKeysList();
			System.out.println("______________________________");
			comp.printSimbols();
		});
		
		dialog.addWindowListener(new WindowAdapter() {
			@Override
			public void windowClosing(WindowEvent e) {
				dialog.setVisible(false);
			}
		});
		
		dialog.add(dialogButton);
		
		m.addActionListener((e)->{
			if(e.getActionCommand() == "Exit") {
				dispose();
				System.exit(0);
			}
			else if(e.getActionCommand() == "Add composition text") {
				dialog.setVisible(true);
			}
		});

		setMenuBar(mb);
		
		GridBagConstraints gbc = new GridBagConstraints();
		

		
		pianoPanel = new Panel();

		pianoPanel.setBackground(Color.DARK_GRAY);
		pianoPanel.setLayout(new BorderLayout());
		add(pianoPanel);
		
		graphicsPanel = new Panel();

		graphicsPanel.setBackground(Color.DARK_GRAY);
		graphicsPanel.setLayout(new GridLayout(1, 1));
		add(graphicsPanel);
		
		recordPanel = new Panel();

		recordPanel.setBackground(Color.DARK_GRAY);
		recordPanel.setLayout(new FlowLayout());
		add(recordPanel);
		
//		playPanel = new Panel();
//		playPanel.setBackground(Color.DARK_GRAY);
//		playPanel.setLayout(new FlowLayout());
//		add(playPanel);
		
	}

	public static void main(String[] args) {
		Frame window = new MainFrame();
		window.setLayout(new GridLayout(3, 1));
		window.setBackground(Color.DARK_GRAY);		
		window.setVisible(true);
	}
}
